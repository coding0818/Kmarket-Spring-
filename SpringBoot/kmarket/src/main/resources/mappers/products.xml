<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.dao.ProductDAO">
   <!--
        날짜 : 2023/02/13
        이름 : 황원진
   -->

    <!--cate별 상품리스트 조회하기-->
    <select id="selectProducts" resultType="kr.co.kmarket.vo.ProductVO" parameterType="map">
        SELECT * FROM `km_product` WHERE `cate1`=#{cate1} AND `cate2`=#{cate2}
        <choose>
            <when test="sort == 'sold'"> ORDER BY `sold` DESC LIMIT #{start}, 10;</when>
            <when test="sort == 'lowPrice'"> ORDER BY `sellPrice` asc LIMIT #{start}, 10;</when>
            <when test="sort == 'highPrice'"> ORDER BY `sellPrice` DESC LIMIT #{start}, 10;</when>
            <when test="sort == 'score'"> ORDER BY `score` DESC LIMIT #{start}, 10;</when>
            <when test="sort == 'review'"> ORDER BY `review` DESC LIMIT #{start}, 10;</when>
            <when test="sort == 'rdate'"> ORDER BY `rdate` DESC LIMIT #{start}, 10;</when>
        </choose>
    </select>

    <!--상품번호로 상품 조회하기-->
    <select id="selectProduct" resultType="kr.co.kmarket.vo.ProductVO">
        select * from `km_product` where `prodNo`=#{prodNo};
    </select>

    <!--상품 네비게이션-->
    <select id="selectNavCate" resultType="kr.co.kmarket.vo.CateVO" parameterType="map">
        SELECT * FROM `km_product_cate1` AS a JOIN `km_product_cate2` AS b
        ON a.cate1 = b.cate1 WHERE a.`cate1`=#{cate1} and b.cate2=#{cate2};
    </select>

    <!--상품 총 갯수-->
    <select id="selectCountProduct" resultType="int">
        select count(`prodNo`) from `km_product` where `cate1`=#{cate1} and `cate2`=#{cate2};
    </select>

    <!--장바구니 등록-->
    <insert id="insertCart">
        insert into `km_product_cart` set
                        `prodNo`=#{prodNo},
                        `uid`=#{seller},
                        `count`=#{count},
                        `price`=#{price},
                        `discount`=#{discount},
                        `point`=#{point},
                        `delivery`=#{delivery},
                        `total`=#{total},
                        `rdate`=NOW();
    </insert>

    <!--장바구니 목록-->
    <select id="selectCart" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT a.*, b.`cate1`, b.`cate2`,b.`thumb2`, b.`prodName`, b.`descript` FROM `km_product_cart` AS a JOIN
        `km_product` AS b ON a.`prodNo` = b.`prodNo`
        WHERE `uid`=#{uid};
    </select>

    <!--장바구니 전체 가격-->
    <select id="selectTotalCart" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT COUNT(`prodNo`) AS COUNT, SUM(`price`) AS price, SUM(`point`) AS POINT, SUM(`delivery`) AS delivery, SUM(`total`) AS total FROM `km_product_cart` WHERE `uid`=#{uid} ;
    </select>

    <!--주문하기 등록-->
    <insert id="insertOrder">
        insert into `km_product_order` set
                        `uid`=#{seller},
                        `ordCount`=#{count},
                        `ordPrice`=#{discount},
                        `ordDelivery`=#{delivery};

    </insert>



</mapper>