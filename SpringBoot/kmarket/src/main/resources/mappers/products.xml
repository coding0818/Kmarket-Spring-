<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.dao.ProductDAO">
   <!--
        날짜 : 2023/02/13
        이름 : 황원진
   -->

    <!--cate별 상품리스트 조회하기-->
    <select id="selectProducts" resultType="kr.co.kmarket.vo.ProductVO" parameterType="map">
        SELECT * FROM `km_product` WHERE `cate1`=#{cate1} AND `cate2`=#{cate2} ORDER BY `prodNo` DESC LIMIT #{start}, 10;
    </select>

    <!--상품번호로 상품 조회하기-->
    <select id="selectProduct" resultType="kr.co.kmarket.vo.ProductVO">
        select * from `km_product` where `prodNo`=#{prodNo};
    </select>

    <!--상품 네비게이션-->
    <select id="selectNavCate" resultType="kr.co.kmarket.vo.CateVO" parameterType="map">
        SELECT * FROM `km_product_cate1` AS a JOIN `km_product_cate2` AS b
        ON a.cate1 = b.cate1 WHERE a.`cate1`=#{cate1} and b.cate2=#{cate2};
    </select>

    <!--상품 총 갯수-->
    <select id="selectCountProduct" resultType="int">
        select count(`prodNo`) from `km_product` where `cate1`=#{cate1} and `cate2`=#{cate2};
    </select>

    <!--장바구니 등록-->
    <insert id="insertCart">
        insert into `km_product_cart` set
                        `prodNo`=#{prodNo},
                        `uid`=#{seller},
                        `count`=#{count},
                        `price`=#{price},
                        `discount`=#{discount},
                        `point`=#{point},
                        `delivery`=#{delivery},
                        `total`=#{total},
                        `rdate`=NOW();
    </insert>

    <!--장바구니 목록-->
    <select id="selectCart" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT a.*, b.`cate1`, b.`cate2`,b.`thumb2`, b.`prodName`, b.`descript` FROM `km_product_cart` AS a JOIN
        `km_product` AS b ON a.`prodNo` = b.`prodNo`
        WHERE `uid`=#{uid};
    </select>

    <!--장바구니 전체 가격-->
    <select id="selectTotalCart" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT COUNT(`prodNo`) AS COUNT, SUM(`price`) AS price, SUM(`point`) AS POINT, SUM(`delivery`) AS delivery, SUM(`total`) AS total FROM `km_product_cart` WHERE `uid`=#{uid} ;
    </select>

    <!--판매량-->
    <select id="selectProductsSold" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `sold` DESC LIMIT #{start}, 10;
    </select>

    <!--가격낮은순-->
    <select id="selectProductsSellpriceDown" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `sellPrice` ASC LIMIT #{start}, 10;
    </select>

    <!--가격높은순-->
    <select id="selectProductsSellpriceUp" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `sellPrice` DESC LIMIT #{start}, 10;
    </select>

    <!--평점높은순-->
    <select id="selectProductsSellpriceScore" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `score` DESC LIMIT #{start}, 10;
    </select>

    <!--리뷰많은순-->
    <select id="selectProductsSellpriceReview" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate} ORDER BY `review` DESC LIMIT #{start}, 10;
    </select>

    <!--최근등록순-->
    <select id="selectProductsSellpriceRdate" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN	`km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate`=#{cate1} and `cate2`=#{cate2} ORDER BY `rdate` DESC LIMIT #{start}, 10;
    </select>



</mapper>