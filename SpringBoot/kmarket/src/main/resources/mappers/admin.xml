<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.dao.admin.AdminProdDAO">
    <!-- 2023/02 이원정 : 관리자 - 상품 - 등록하기 및 목록 불러오기 -->
    <!-- 쿼리문에 따옴표 항상 주의!! -->
    <!-- 관리자 - 상품 등록 -->
    <insert id="registerProduct">
        insert into `km_product` set
        `cate1`=#{cate1},
        `cate2`=#{cate2},
        `seller`=#{seller},
        `prodName`=#{prodName},
        `descript`=#{descript},
        `company`=#{company},
        `price`=#{price},
        `discount`=#{discount},
        `point`=#{point},
        `stock`=#{stock},
        `delivery`=#{delivery},
        `thumb1`=#{newThumb1},
        `thumb2`=#{newThumb2},
        `thumb3`=#{newThumb3},
        `detail`=#{newDetail},
        `status`=#{status},
        `duty`=#{duty},
        `receipt`=#{receipt},
        `bizType`=#{bizType},
        `origin`=#{origin},
        `ip`=#{ip},
        `prod_no`=null,
        `prod_name`=null,
        `rdate`=NOW();
    </insert>
    <!-- 관리자, 판매회원 구별-->
    <select id="selectLevel" resultType="kr.co.kmarket.vo.ProductVO">
        select `uid`, `level` from `km_member_seller` where `uid`=#{uid};
    </select>
    <!-- 관리자 - 상품 목록 (판매자가 조회 시) selectProductss -->
    <select id="selectProducts" resultType="kr.co.kmarket.vo.ProductVO">
        select a.*, b.* from `km_product` as a
        join `km_member_seller` as b on a.`seller`=b.`uid`
        where `seller`=#{seller} order by `prodNo` desc limit #{start}, 10;
    </select>
    <!-- 관리자 - 상품 목록 (관리자가 조회 시) selectProduct -->
    <select id="selectProductsAdmin" resultType="kr.co.kmarket.vo.ProductVO">
        select * from `km_product` as a join
        `km_member_seller` as b on a.`seller`=b.`uid`
        order by `prodNo` desc limit #{start}, 10;
    </select>

    <!-- 관리자 - 상품 목록 - 페이징 -->
    <select id="selectCountProduct" resultType="int">
        select count(`prodNo`) from `km_product` where `seller`=#{seller};
    </select>


    <select id="selectProdNo" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT MAX(`prodNo`) FROM `km_product`;
    </select>

<!--현재 admin에 연결되어있음 productDAO를 만들어서 옮겨야함-->
    <!--판매량-->
    <select id="selectProductsSold" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `sold` DESC LIMIT #{start}, 10;
    </select>

    <!--가격낮은순-->
    <select id="selectProductsSellpriceDown" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `sellPrice` ASC LIMIT #{start}, 10;
    </select>

    <!--가격높은순-->
    <select id="selectProductsSellpriceUp" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `sellPrice` DESC LIMIT #{start}, 10;
    </select>

    <!--평점높은순-->
    <select id="selectProductsSellpriceScore" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate2} ORDER BY `score` DESC LIMIT #{start}, 10;
    </select>

    <!--리뷰많은순-->
    <select id="selectProductsSellpriceReview" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN `km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate1`=#{cate1} and `cate2`=#{cate} ORDER BY `review` DESC LIMIT #{start}, 10;
    </select>

    <!--최근등록순-->
    <select id="selectProductsSellpriceRdate" resultType="kr.co.kmarket.vo.ProductVO">
        SELECT A.*, B.`level` FROM `km_product` AS A
        JOIN	`km_member_seller` AS B ON A.`seller` = B.`uid`
        WHERE `cate`=#{cate1} and `cate2`=#{cate2} ORDER BY `rdate` DESC LIMIT #{start}, 10;
    </select>



</mapper>